<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لوحة التحكم - Dima AI</title>
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        :root {
            /* Cosmic Color Palette (from your existing styles) */
            --gradient-start: #1A2980; /* Deep Indigo */
            --gradient-end: #26D0CE;   /* Vibrant Teal */
            --gradient-start-rgb: 26, 41, 128;
            --gradient-end-rgb: 38, 208, 206;

            --color-nebula-deep: #080A10; 
            --color-nebula-mid: #10182B;  
            --color-nebula-highlight: #3D52A0; 
            --color-star: #FFFFFF;
            
            --color-primary-dark: var(--gradient-start);
            --color-primary-light: var(--gradient-end);

            --color-background-dark: var(--color-nebula-deep);
            --color-background-medium-dark: #101419; /* Slightly lighter for app bg */
            --color-background-panel: #151E33; /* For cards and panels in dashboard */
            --color-background-panel-hover: #1B263E;
            --color-background-light: #FFFFFF;
            --color-background-offwhite: #F9FAFB; 

            --color-text-light: #EAEFF3;
            --color-text-primary-on-dark: #FFFFFF;
            --color-text-dark: #1A202C;
            --color-text-medium: #A0AEC0; /* Lighter medium for dark bg */
            --color-text-muted: #718096;
            --color-accent: #FBBF24; 
            --color-focus-ring: #4DA8DA;

            --color-success: #38A169;
            --color-warning: #DD6B20;
            --color-danger: #E53E3E;

            --font-primary: 'Manrope', 'Cairo', sans-serif;
            --font-secondary: 'Inter', 'Cairo', sans-serif;

            --border-radius-sm: 6px;
            --border-radius-md: 8px;
            --border-radius-lg: 12px;
            --border-radius-xl: 16px; 
            --shadow-subtle: 0 2px 8px rgba(0,0,0,0.07);
            --shadow-medium: 0 6px 15px rgba(0,0,0,0.1);
            --shadow-strong: 0 10px 30px rgba(0,0,0,0.12), 0 2px 10px rgba(0,0,0,0.08);
            --shadow-app-panel: 0 8px 25px rgba(0,0,0,0.2), 0 0 0 1px rgba(var(--color-nebula-highlight-rgb, 61, 82, 160), 0.2);

            --sidebar-width: 260px;
            --header-height: 70px;
        }

        @import url('https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;700;800&family=Inter:wght@400;500;600&family=Cairo:wght@400;600;700;800&display=swap');

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: var(--font-secondary);
            color: var(--color-text-light); /* Default text color for app */
            line-height: 1.6;
            background-color: var(--color-background-medium-dark); 
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        html { scroll-behavior: smooth; }

        /* Basic typography for app */
        h1, h2, h3, h4, h5, h6 { font-family: var(--font-primary); font-weight: 700; margin-bottom: 0.75em; line-height: 1.3; color: var(--color-text-primary-on-dark); }
        h1 { font-size: clamp(1.8rem, 3vw, 2.2rem); font-weight: 800; }
        h2 { font-size: clamp(1.5rem, 2.5vw, 1.8rem); }
        h3 { font-size: clamp(1.2rem, 2vw, 1.4rem); }
        p { margin-bottom: 1em; color: var(--color-text-medium); font-size: clamp(0.9rem, 1.5vw, 1rem); }
        a { color: var(--gradient-end); text-decoration: none; transition: color 0.2s ease; }
        a:hover { color: var(--color-primary-light); filter: brightness(1.2); }

        .container-fluid { width: 100%; padding: 0 25px; }

        /* App Layout */
        .app-layout {
            display: flex;
            min-height: 100vh;
        }

        .app-sidebar {
            width: var(--sidebar-width);
            background-color: var(--color-background-dark);
            padding: 25px 20px;
            display: flex;
            flex-direction: column;
            position: fixed;
            top: 0;
            right: 0; /* RTL */
            bottom: 0;
            z-index: 100;
            border-left: 1px solid rgba(var(--color-nebula-highlight-rgb, 61, 82, 160), 0.2); /* RTL */
            transition: transform 0.3s ease;
        }
        
        .sidebar-logo {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--color-text-primary-on-dark);
            margin-bottom: 30px;
            text-align: center;
            font-family: var(--font-primary);
        }
        .sidebar-logo i {
            margin-left: 8px; /* RTL */
            color: var(--gradient-end);
        }

        .app-nav ul { list-style: none; }
        .app-nav li a {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            margin-bottom: 8px;
            border-radius: var(--border-radius-md);
            color: var(--color-text-medium);
            font-weight: 500;
            transition: background-color 0.2s ease, color 0.2s ease;
        }
        .app-nav li a i {
            margin-left: 12px; /* RTL */
            font-size: 1.1em;
            width: 20px;
            text-align: center;
        }
        .app-nav li a:hover {
            background-color: rgba(var(--gradient-end-rgb), 0.1);
            color: var(--color-text-light);
        }
        .app-nav li a.active {
            background-color: var(--gradient-start);
            color: var(--color-text-primary-on-dark);
            font-weight: 600;
            box-shadow: 0 4px 10px rgba(var(--gradient-start-rgb),0.2);
        }
        .app-nav li a.active i { color: var(--gradient-end); }

        .sidebar-footer {
            margin-top: auto;
            padding-top: 20px;
            border-top: 1px solid rgba(var(--color-nebula-highlight-rgb, 61, 82, 160), 0.15);
        }

        .main-content-wrapper {
            flex-grow: 1;
            padding-right: var(--sidebar-width); /* RTL */
            display: flex;
            flex-direction: column;
        }

        .app-header {
            height: var(--header-height);
            background-color: var(--color-background-dark);
            border-bottom: 1px solid rgba(var(--color-nebula-highlight-rgb, 61, 82, 160), 0.2);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 30px;
            position: sticky;
            top: 0;
            z-index: 90;
        }
        .app-header .page-title { font-size: 1.3rem; font-weight: 600; color: var(--color-text-light); margin:0;}
        .header-actions { display: flex; align-items: center; gap: 20px; }
        .header-actions .icon-btn { background: none; border: none; color: var(--color-text-medium); font-size: 1.3rem; cursor: pointer; transition: color 0.2s ease; }
        .header-actions .icon-btn:hover { color: var(--color-text-light); }
        .user-profile-avatar {
            width: 36px; height: 36px; border-radius: 50%;
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
            color: var(--color-text-primary-on-dark);
            display: flex; align-items: center; justify-content: center;
            font-weight: 600; cursor: pointer;
            box-shadow: 0 0 10px rgba(var(--gradient-end-rgb), 0.3);
        }

        .page-content {
            flex-grow: 1;
            padding: 30px;
            overflow-y: auto;
        }
        .dashboard-header { margin-bottom: 30px; }
        .dashboard-header h1 { color: var(--color-text-light); }
        .dashboard-header p { color: var(--color-text-medium); font-size: 1.1rem; }

        /* Dashboard Grid Layout */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 2fr 1fr; /* Main content and sidebar-like column */
            gap: 30px;
        }
        @media (max-width: 1200px) {
            .dashboard-grid { grid-template-columns: 1fr; }
            .grid-sidebar-column { order: -1; /* Moves it to top on smaller screens if desired or handle differently */}
        }
        @media (max-width: 768px) {
            .page-content { padding: 20px; }
            .dashboard-grid { gap: 20px; }
        }


        /* Dashboard Sections & Cards */
        .dashboard-section {
            background-color: var(--color-background-panel);
            padding: 25px;
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-app-panel);
            margin-bottom: 30px;
            border: 1px solid rgba(var(--color-nebula-highlight-rgb,61,82,160),0.25);
        }
        .dashboard-section .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(var(--color-nebula-highlight-rgb,61,82,160),0.15);
        }
        .dashboard-section .section-header h2 { margin-bottom: 0; font-size: 1.4rem; }

        /* System Toggle Switch */
        .system-toggle-container { display: flex; align-items: center; gap: 10px; }
        .system-toggle-container .status-text { font-weight: 600; font-size: 0.9rem; }
        .system-toggle-container .status-text.active { color: var(--color-success); }
        .system-toggle-container .status-text.inactive { color: var(--color-danger); }
        .switch { position: relative; display: inline-block; width: 50px; height: 28px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #394B6A; transition: .4s; border-radius: 28px; }
        .slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background: linear-gradient(90deg, var(--gradient-start), var(--gradient-end)); }
        input:focus + .slider { box-shadow: 0 0 1px var(--gradient-end); }
        input:checked + .slider:before { transform: translateX(22px); }

        /* Chatbot Module ("Amazing Object") */
        .chatbot-control-section .chatbot-module {
            display: flex;
            align-items: center;
            gap: 30px;
            padding: 20px 0;
        }
        .chatbot-visual-wrapper {
            flex-shrink: 0;
            position: relative;
        }
        .dima-ai-orb {
            width: 180px; height: 180px;
            position: relative;
            display: flex; align-items: center; justify-content: center;
            transform-style: preserve-3d;
            animation: floatOrb 8s ease-in-out infinite;
        }
        @keyframes floatOrb {
            0%, 100% { transform: translateY(0px) rotateY(0deg); }
            50% { transform: translateY(-10px) rotateY(15deg); }
        }
        .orb-core {
            width: 70px; height: 70px;
            background: radial-gradient(ellipse at center, var(--gradient-end) 20%, var(--gradient-start) 80%);
            border-radius: 50%;
            box-shadow: 0 0 25px rgba(var(--gradient-end-rgb), 0.7), 
                        0 0 40px rgba(var(--gradient-start-rgb), 0.5),
                        inset 0 0 15px rgba(255,255,255,0.3);
            animation: pulseCore 3s ease-in-out infinite alternate;
            position: relative; z-index: 2;
        }
        @keyframes pulseCore {
            from { transform: scale(0.95); box-shadow: 0 0 20px rgba(var(--gradient-end-rgb),0.6), 0 0 35px rgba(var(--gradient-start-rgb),0.4), inset 0 0 10px rgba(255,255,255,0.2); }
            to   { transform: scale(1); box-shadow: 0 0 30px rgba(var(--gradient-end-rgb),0.8), 0 0 50px rgba(var(--gradient-start-rgb),0.6), inset 0 0 20px rgba(255,255,255,0.4); }
        }
        .orb-ring {
            position: absolute;
            border-radius: 50%;
            border: 2px solid;
            opacity: 0.5;
            animation: rotateRing 10s linear infinite;
        }
        .orb-ring.ring1 { width: 120px; height: 120px; border-color: rgba(var(--gradient-end-rgb), 0.6); animation-duration: 10s; transform: rotateX(70deg) rotateY(20deg); }
        .orb-ring.ring2 { width: 150px; height: 150px; border-color: rgba(var(--gradient-start-rgb), 0.5); animation-duration: 13s; animation-direction: reverse; transform: rotateX(60deg) rotateY(-30deg); }
        .orb-ring.ring3 { width: 180px; height: 180px; border-color: rgba(var(--color-nebula-highlight-rgb), 0.4); animation-duration: 16s; transform: rotateX(50deg) rotateY(40deg); }
        
        @keyframes rotateRing {
            from { transform: rotateX(70deg) rotateY(20deg) rotateZ(0deg); }
            to   { transform: rotateX(70deg) rotateY(20deg) rotateZ(360deg); }
        }
        .orb-ring.ring2 { animation-name: rotateRing2; }
        @keyframes rotateRing2 {
            from { transform: rotateX(60deg) rotateY(-30deg) rotateZ(0deg); }
            to   { transform: rotateX(60deg) rotateY(-30deg) rotateZ(360deg); }
        }
        .orb-ring.ring3 { animation-name: rotateRing3; }
         @keyframes rotateRing3 {
            from { transform: rotateX(50deg) rotateY(40deg) rotateZ(0deg); }
            to   { transform: rotateX(50deg) rotateY(40deg) rotateZ(360deg); }
        }


        .chatbot-details { flex-grow: 1; }
        .chatbot-details h3 { font-size: 1.3rem; color: var(--color-text-light); margin-bottom: 8px; }
        .chatbot-details p { font-size: 1rem; color: var(--color-text-medium); margin-bottom: 20px; }
        .chatbot-actions { display: flex; gap: 15px; margin-bottom: 15px; flex-wrap: wrap; }
        .quick-links a { color: var(--color-text-muted); font-size: 0.9rem; }
        .quick-links a:hover { color: var(--gradient-end); }
        .quick-links span { margin: 0 8px; color: var(--color-text-muted); }

        @media (max-width: 768px) {
            .chatbot-control-section .chatbot-module { flex-direction: column; text-align: center; }
            .dima-ai-orb { width: 150px; height: 150px; margin-bottom: 20px; }
            .orb-core { width: 60px; height: 60px; }
            .orb-ring.ring1 { width: 100px; height: 100px; }
            .orb-ring.ring2 { width: 125px; height: 125px; }
            .orb-ring.ring3 { width: 150px; height: 150px; }
            .chatbot-actions { justify-content: center; }
        }

        /* App Buttons */
        .btn-app {
            display: inline-flex; align-items: center; justify-content: center;
            padding: 10px 20px;
            border-radius: var(--border-radius-md);
            text-decoration: none;
            font-family: var(--font-primary);
            font-weight: 600;
            font-size: 0.9rem;
            transition: transform 0.2s cubic-bezier(0.25, 0.1, 0.25, 1), box-shadow 0.3s cubic-bezier(0.25, 0.1, 0.25, 1), background-color 0.2s ease, border-color 0.2s ease;
            border: 1px solid transparent;
            cursor: pointer;
        }
        .btn-app i { margin-left: 8px; /* RTL */ }
        .btn-app-primary {
            background: linear-gradient(90deg, var(--gradient-start) 0%, var(--gradient-end) 100%);
            color: var(--color-text-primary-on-dark);
            box-shadow: 0 4px 12px rgba(var(--gradient-end-rgb), 0.2);
        }
        .btn-app-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(var(--gradient-end-rgb), 0.3);
            filter: brightness(1.1);
        }
        .btn-app-secondary {
            background-color: var(--color-nebula-highlight);
            color: var(--color-text-light);
        }
        .btn-app-secondary:hover {
            background-color: color-mix(in srgb, var(--color-nebula-highlight), #fff 10%);
            transform: translateY(-2px);
        }
        .btn-app-outline {
            background-color: transparent;
            color: var(--gradient-end);
            border-color: var(--gradient-end);
        }
        .btn-app-outline:hover {
            background-color: rgba(var(--gradient-end-rgb), 0.1);
            color: var(--color-text-light);
        }
         .btn-app-manage {
            background-color: var(--color-success);
            color: var(--color-text-primary-on-dark);
        }
        .btn-app-manage:hover {
            background-color: color-mix(in srgb, var(--color-success), #000 10%);
            transform: translateY(-2px);
        }
        .btn-app-link { background: none; padding: 5px 0; color: var(--gradient-end); font-weight: 500; }
        .btn-app-link:hover { text-decoration: underline; }

        /* Connect Accounts Section */
        .account-connection-list { display: flex; flex-direction: column; gap: 15px; }
        .account-card {
            display: flex;
            align-items: center;
            padding: 15px;
            background-color: var(--color-background-medium-dark);
            border-radius: var(--border-radius-md);
            border: 1px solid rgba(var(--color-nebula-highlight-rgb,61,82,160),0.2);
            transition: background-color 0.2s ease, border-color 0.2s ease;
        }
        .account-card:hover {
            background-color: var(--color-background-panel-hover);
            border-color: var(--gradient-end);
        }
        .account-icon { font-size: 1.8rem; margin-left: 15px; /* RTL */ width: 30px; text-align: center; }
        .account-info { flex-grow: 1; }
        .account-info h4 { font-size: 1rem; margin-bottom: 3px; color: var(--color-text-light); }
        .account-info p { font-size: 0.85rem; margin-bottom: 0; color: var(--color-text-muted); }
        .account-info .status-connected { color: var(--color-success); font-weight: 500; }
        .account-info .status-disconnected { color: var(--color-warning); }
        .account-info .status-pending { color: var(--color-text-muted); }
        .account-card .btn-app { padding: 8px 15px; font-size: 0.85rem; }

        /* Flow Builder Teaser */
        .flow-builder-teaser {
            display: flex;
            align-items: center;
            gap: 30px;
            background-color: rgba(var(--gradient-start-rgb), 0.1);
            padding: 25px;
            border-radius: var(--border-radius-md);
            border: 1px solid var(--gradient-start);
        }
        .flow-builder-teaser .teaser-text { flex-basis: 60%; }
        .flow-builder-teaser .teaser-text h3 { color: var(--color-text-light); font-size: 1.3rem; }
        .flow-builder-teaser .teaser-text p { color: var(--color-text-medium); margin-bottom: 20px; }
        .flow-builder-teaser .teaser-actions { display: flex; gap: 15px; flex-wrap: wrap; }
        .flow-builder-teaser .teaser-visual {
            flex-basis: 40%;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px;
            background-color: rgba(var(--color-nebula-deep-rgb), 0.3);
            border-radius: var(--border-radius-sm);
            min-height: 180px;
        }
        .flow-node-mini {
            background-color: var(--node-color, var(--color-nebula-highlight));
            color: white;
            padding: 8px 12px;
            border-radius: var(--border-radius-sm);
            font-size: 0.8rem;
            display: inline-flex; align-items: center; gap: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            width: 150px; text-align: center; justify-content: center;
        }
        .flow-connector-mini {
            width: 2px; height: 20px;
            background-color: var(--color-text-muted);
            margin: 5px 0;
        }
        @media (max-width: 992px) {
            .flow-builder-teaser { flex-direction: column; text-align: center; }
            .flow-builder-teaser .teaser-text { flex-basis: auto; margin-bottom: 20px; }
            .flow-builder-teaser .teaser-actions { justify-content: center; }
            .flow-builder-teaser .teaser-visual { flex-basis: auto; width: 100%; max-width: 250px;}
        }
        

        /* Quick Stats Section */
        .quick-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .stat-item {
            background-color: var(--color-background-medium-dark);
            padding: 15px;
            border-radius: var(--border-radius-md);
            text-align: center;
            border: 1px solid rgba(var(--color-nebula-highlight-rgb,61,82,160),0.2);
        }
        .stat-value { display: block; font-size: 1.6rem; font-weight: 700; color: var(--color-text-light); margin-bottom: 5px; }
        .stat-label { display: block; font-size: 0.85rem; color: var(--color-text-muted); margin-bottom: 5px; }
        .stat-change { font-size: 0.8rem; font-weight: 500; }
        .stat-change.positive { color: var(--color-success); }
        .stat-change.negative { color: var(--color-danger); }
        .stat-change.neutral { color: var(--color-text-muted); }

        /* AI Helper FAB */
        .ai-helper-fab {
            position: fixed;
            bottom: 30px;
            left: 30px; /* RTL: right */
            background: linear-gradient(135deg, var(--gradient-end), var(--gradient-start));
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            box-shadow: 0 5px 15px rgba(var(--gradient-end-rgb), 0.4);
            cursor: pointer;
            z-index: 1000;
            transition: transform 0.3s ease;
        }
        .ai-helper-fab:hover {
            transform: scale(1.1) rotate(15deg);
            box-shadow: 0 8px 20px rgba(var(--gradient-end-rgb), 0.5);
        }


        /* Responsive Sidebar */
        .sidebar-toggle-btn {
            display: none; /* Hidden by default, shown on small screens */
            background: none; border: none; color: var(--color-text-light);
            font-size: 1.5rem; cursor: pointer;
            position: absolute; top: 18px; right: 20px; /* RTL */
            z-index: 110;
        }

        @media (max-width: 992px) { /* Tablet and smaller */
            .app-sidebar {
                transform: translateX(100%); /* RTL: Hide to the right */
            }
            .app-sidebar.is-open {
                transform: translateX(0);
            }
            .main-content-wrapper {
                padding-right: 0; /* RTL */
            }
            .sidebar-toggle-btn {
                display: block;
            }
            .app-header { padding: 0 15px 0 60px; /* Space for toggle button on right */ }
        }

        .flow-builder-link {
            display: flex;
            align-items: center;
            padding: 15px;
            background: linear-gradient(135deg, var(--gradient-start) 0%, var(--gradient-end) 100%);
            border-radius: 10px;
            color: white;
            text-decoration: none;
            margin: 10px;
            transition: all 0.3s ease;
        }

        .flow-builder-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .flow-builder-link i {
            margin-left: 10px;
            font-size: 1.2em;
        }
    </style>
</head>
<body>

    <div class="app-layout">
        <button class="sidebar-toggle-btn" id="sidebarToggle"><i class="fas fa-bars"></i></button>
        <aside class="app-sidebar" id="appSidebar">
            <div class="sidebar-logo">
                <i class="fas fa-meteor"></i> Dima AI
            </div>
            <nav class="app-nav">
                <ul>
                    <li><a href="#" class="active"><i class="fas fa-tachometer-alt"></i> لوحة التحكم</a></li>
                    <li><a href="#"><i class="fas fa-link"></i> الاتصالات</a></li>
                    <li><a href="#"><i class="fas fa-drafting-compass"></i> مصمم التدفقات</a></li>
                    <li><a href="#"><i class="fas fa-chart-line"></i> التحليلات</a></li>
                    <li><a href="#"><i class="fas fa-store"></i> إدارة المتجر</a></li>
                    <li><a href="#"><i class="fas fa-users-cog"></i> الوكلاء</a></li>
                    <li><a href="#"><i class="fas fa-cog"></i> الإعدادات</a></li>
                </ul>
            </nav>
            <div class="sidebar-footer">
                <nav class="app-nav">
                    <ul>
                        <li><a href="#"><i class="fas fa-question-circle"></i> الدعم الفني</a></li>
                        <li><a href="#"><i class="fas fa-book"></i> توثيق النظام</a></li>
                    </ul>
                </nav>
            </div>
        </aside>

        <div class="main-content-wrapper">
            <header class="app-header">
                <h1 class="page-title">لوحة التحكم الرئيسية</h1>
                <div class="header-actions">
                    <!-- Search (Optional) -->
                    <!-- <input type="search" placeholder="Search..." class="app-search-bar"> -->
                    <button class="icon-btn" aria-label="Notifications"><i class="fas fa-bell"></i></button>
                    <div class="user-profile-avatar" aria-label="User Profile">GC</div> <!-- GC for Galaxy Commander -->
                </div>
            </header>

            <main class="page-content">
                <div class="dashboard-header">
                    <h1>أهلاً بك مجدداً، قائد المجرة!</h1>
                    <p>هنا مركز قيادتك الكوني. قم بإعداد وكيل Dima AI الخاص بك، وربط قنواتك، وانطلق نحو النجوم.</p>
                </div>

                <div class="dashboard-grid">
                    <div class="grid-main-column">
                        <!-- Chatbot Module -->
                        <section class="dashboard-section chatbot-control-section">
                            <div class="section-header">
                                <h2>وكيل Dima AI الخاص بك</h2>
                                <div class="system-toggle-container">
                                    <span id="systemStatusLabel" class="status-text active">نشط</span>
                                    <label class="switch">
                                        <input type="checkbox" id="systemToggleSwitch" checked>
                                        <span class="slider round"></span>
                                    </label>
                                    <span>حالة النظام:</span>
                                </div>
                            </div>
                            <div class="chatbot-module">
                                <div class="chatbot-visual-wrapper">
                                    <div class="dima-ai-orb">
                                        <div class="orb-core"></div>
                                        <div class="orb-ring ring1"></div>
                                        <div class="orb-ring ring2"></div>
                                        <div class="orb-ring ring3"></div>
                                    </div>
                                </div>
                                <div class="chatbot-details">
                                    <h3>محرك الذكاء الاصطناعي الكوني</h3>
                                    <p>قم بتهيئة وإدارة قوة الذكاء الاصطناعي الخاصة بك. اضبط المعلمات، وراجع السجلات، وحسّن الأداء.</p>
                                    <div class="chatbot-actions">
                                        <button class="btn-app btn-app-primary"><i class="fas fa-cogs"></i> تعديل المعلمات</button>
                                        <button class="btn-app btn-app-secondary"><i class="fas fa-microchip"></i> تخصيص النموذج</button>
                                    </div>
                                    <div class="quick-links">
                                        <a href="#">عرض السجل</a> <span>|</span> <a href="#">قاعدة المعرفة</a>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <!-- Flow Builder Teaser -->
                        <section class="dashboard-section flow-builder-teaser-section">
                             <div class="section-header">
                                <h2>أتمتة عالمك التجاري</h2>
                            </div>
                            <div class="flow-builder-teaser">
                                <div class="teaser-text">
                                    <h3>أنشئ تدفقات شات بوت قوية</h3>
                                    <p>صمم تفاعلات مخصصة، اتصل بأدواتك، وقم بأتمتة مهام التجارة الإلكترونية الخاصة بك باستخدام منشئ التدفقات المرئي بالسحب والإفلات.</p>
                                    <div class="teaser-actions">
                                        <button class="btn-app btn-app-primary"><i class="fas fa-plus-circle"></i> إنشاء تدفق جديد</button>
                                        <button class="btn-app btn-app-secondary"><i class="fas fa-th-large"></i> تصفح القوالب</button>
                                    </div>
                                </div>
                                <div class="teaser-visual">
                                    <div class="flow-node-mini" style="--node-color: #C13584;"> <i class="fab fa-instagram"></i> رسالة إنستغرام</div>
                                    <div class="flow-connector-mini"></div>
                                    <div class="flow-node-mini" style="--node-color: var(--gradient-start);"> <i class="fas fa-brain"></i> منطق Dima AI</div>
                                    <div class="flow-connector-mini"></div>
                                    <div class="flow-node-mini" style="--node-color: #0088cc;"> <i class="fas fa-paper-plane"></i> إرسال رد</div>
                                     <div class="flow-connector-mini"></div>
                                    <div class="flow-node-mini" style="--node-color: var(--color-success);"> <i class="fas fa-tags"></i> إضافة وسم للعميل</div>
                                </div>
                            </div>
                        </section>
                    </div>

                    <div class="grid-sidebar-column">
                        <!-- Connect Accounts -->
                        <section class="dashboard-section connect-accounts-section">
                            <div class="section-header">
                                <h2>ربط قنواتك الكونية</h2>
                            </div>
                            <div class="account-connection-list">
                                <!-- Keep only this Instagram card and add the IDs -->
                                <div class="account-card" id="instagramAccountCard">
                                    <i class="fab fa-instagram account-icon" style="color: #E1306C;"></i>
                                    <div class="account-info">
                                        <h4>إنستغرام</h4>
                                        <p id="instagramStatus" class="status-disconnected">غير متصل</p>
                                    </div>
                                    <button class="btn-app btn-app-outline" id="connectInstagramBtn">ربط الحساب</button>
                                </div>
                                <!-- ... Other account cards ... -->
                            </div>
                        </section>

                         <!-- Quick Stats -->
                        <section class="dashboard-section quick-stats-section">
                            <div class="section-header">
                                <h2>لمحة عن الأداء</h2>
                            </div>
                            <div class="quick-stats-grid">
                                <div class="stat-item">
                                    <span class="stat-value">1,287</span>
                                    <span class="stat-label">إجمالي المحادثات</span>
                                    <span class="stat-change positive"><i class="fas fa-arrow-up"></i> 15%</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-value">95%</span>
                                    <span class="stat-label">معدل الأتمتة</span>
                                    <span class="stat-change neutral"><i class="fas fa-minus"></i> 1%</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-value">235 ألف دج</span>
                                    <span class="stat-label">مبيعات مساعدة</span>
                                     <span class="stat-change positive"><i class="fas fa-arrow-up"></i> 22%</span>
                                </div>
                                 <div class="stat-item">
                                    <span class="stat-value">4.7 <i class="fas fa-star" style="color: var(--color-accent); font-size: 0.8em;"></i></span>
                                    <span class="stat-label">رضا العملاء</span>
                                     <span class="stat-change positive"><i class="fas fa-arrow-up"></i> 0.2</span>
                                </div>
                            </div>
                            <a href="#analytics" class="btn-app btn-app-link" style="display: block; text-align: center;">عرض التحليلات الكاملة <i class="fas fa-angle-left"></i></a>
                        </section>

                        <!-- New Section for Flow Builder Link -->
                        <section class="dashboard-section">
                            <h2>التدفقات الكونية</h2>
                            <a href="space.html" class="flow-builder-link">
                                <i class="fas fa-project-diagram"></i>
                                مصمم التدفقات الكونية
                            </a>
                        </section>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <div class="ai-helper-fab" title="مساعد ديما الذكي">
        <i class="fas fa-magic"></i>
    </div>



   
    <script>document.addEventListener('DOMContentLoaded', () => {
            const sidebar = document.getElementById('appSidebar');
            const sidebarToggle = document.getElementById('sidebarToggle');
            const systemToggleSwitch = document.getElementById('systemToggleSwitch');
            const systemStatusLabel = document.getElementById('systemStatusLabel');

            if (sidebarToggle && sidebar) {
                sidebarToggle.addEventListener('click', () => {
                    sidebar.classList.toggle('is-open');
                });
            }

            if (systemToggleSwitch && systemStatusLabel) {
                systemToggleSwitch.addEventListener('change', function() {
                    if (this.checked) {
                        systemStatusLabel.textContent = 'نشط';
                        systemStatusLabel.className = 'status-text active';
                    } else {
                        systemStatusLabel.textContent = 'غير نشط';
                        systemStatusLabel.className = 'status-text inactive';
                    }
                });
            }

            // Smooth scroll for any #analytics link (could be improved for all # links)
            document.querySelectorAll('a[href="#analytics"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    // In a real app, this would navigate to the analytics page/section.
                    // For now, it just prevents default.
                    alert('الانتقال إلى صفحة التحليلات (قيد الإنشاء)!');
                    // If analytics were a section on this page:
                    // document.querySelector(this.getAttribute('href')).scrollIntoView({ behavior: 'smooth' });
                });
            });

            const YOUR_APP_ID = '1323436732086944'; 
            const connectBtn = document.getElementById('connectInstagramBtn');
            const instagramStatus = document.getElementById('instagramStatus');

            const modal = document.getElementById('pagesModal');
            const modalCloseBtn = document.getElementById('modalCloseBtn');
            const modalLoader = document.getElementById('modalLoader');
            const modalPageList = document.getElementById('modalPageList');
            const modalStatus = document.getElementById('modalStatus');

            // --- Load Facebook SDK ---
            window.fbAsyncInit = function() {
                FB.init({
                    appId: YOUR_APP_ID,
                    cookie: true,
                    xfbml: true,
                    version: 'v19.0'
                });
            };
            (function(d, s, id){
                var js, fjs = d.getElementsByTagName(s)[0];
                if (d.getElementById(id)) {return;}
                js = d.createElement(s); js.id = id;
                js.src = "https://connect.facebook.net/en_US/sdk.js";
                fjs.parentNode.insertBefore(js, fjs);
            }(document, 'script', 'facebook-jssdk'));
            
            // --- Event Listeners ---
            connectBtn.addEventListener('click', handleConnectClick);
            modalCloseBtn.addEventListener('click', () => modal.style.display = 'none');

            // --- Main Logic Functions ---
            function handleConnectClick() {
                connectBtn.textContent = 'جاري الاتصال...';
                connectBtn.disabled = true;

                const requiredPermissions = 'pages_show_list,instagram_basic,instagram_manage_messages,pages_read_engagement';
                
                FB.login(function(response) {
                    if (response.authResponse) {
                        // User is logged in and authorized
                        openPagesModal();
                        fetchInstagramPages(response.authResponse.accessToken);
                    } else {
                        // User cancelled login or did not fully authorize
                        alert('فشل تسجيل الدخول. يرجى السماح بالأذونات المطلوبة.');
                        resetConnectButton();
                    }
                }, { scope: requiredPermissions });
            }
            
            function openPagesModal() {
                modal.style.display = 'flex';
                modalLoader.style.display = 'block';
                modalPageList.innerHTML = '';
                modalStatus.textContent = '';
            }

            function fetchInstagramPages(userAccessToken) {
                FB.api(
                    '/me/accounts',
                    { fields: 'name,access_token,instagram_business_account{name,username,profile_picture_url}', access_token: userAccessToken },
                    function(response) {
                        modalLoader.style.display = 'none';
                        if (response && !response.error) {
                            const igPages = response.data.filter(page => page.instagram_business_account);
                            if (igPages.length > 0) {
                                displayPagesInModal(igPages);
                            } else {
                                modalStatus.textContent = 'لم يتم العثور على حسابات إنستغرام للأعمال. يرجى التأكد من أن حسابك هو حساب أعمال ومتصل بصفحة فيسبوك.';
                            }
                        } else {
                            modalStatus.textContent = 'خطأ في جلب الصفحات: ' + response.error.message;
                        }
                    }
                );
            }

            function displayPagesInModal(pages) {
                pages.forEach(page => {
                    const li = document.createElement('li');
                    li.innerHTML = `
                        <div>
                            <strong class="page-name">${page.instagram_business_account.name}</strong><br>
                            <span class="page-username">@${page.instagram_business_account.username}</span>
                        </div>
                    `;
                    const selectBtn = document.createElement('button');
                    selectBtn.textContent = 'اختر';
                    selectBtn.className = 'btn-app btn-app-secondary';
                    selectBtn.onclick = () => {
                        modalStatus.textContent = `جاري ربط @${page.instagram_business_account.username}...`;
                        subscribePageToApp(page.id, page.access_token, page.instagram_business_account.username);
                    };
                    li.appendChild(selectBtn);
                    modalPageList.appendChild(li);
                });
            }

            function subscribePageToApp(pageId, pageAccessToken, igUsername) {
                FB.api(
                    `/${pageId}/subscribed_apps`,
                    'post',
                    { subscribed_fields: ['messages'], access_token: pageAccessToken },
                    function(response) {
                        if (response && response.success) {
                            modal.style.display = 'none';
                            updateDashboardToConnected(igUsername);
                            alert('تم ربط الصفحة بنجاح!');
                        } else {
                            modalStatus.innerHTML = 'خطأ: لم نتمكن من ربط الصفحة. ' + (response.error ? response.error.message : '');
                        }
                    }
                );
            }
            
            function updateDashboardToConnected(igUsername) {
                instagramStatus.textContent = `متصل: @${igUsername}`;
                instagramStatus.className = 'status-connected';
                connectBtn.textContent = 'إدارة';
                connectBtn.className = 'btn-app btn-app-manage'; // Change style to green "manage" button
                connectBtn.disabled = false;
                // Optional: Change button functionality to manage settings
                connectBtn.onclick = () => { alert('إدارة إعدادات إنستغرام (قيد الإنشاء)!'); }; 
            }
            
            function resetConnectButton() {
                connectBtn.textContent = 'ربط الحساب';
                connectBtn.disabled = false;
            }
        });
        
    </script>

    <script type="module">
    import { getAuth, signOut } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";

    const auth = getAuth();

    // Handle Logout
    const logoutButton = document.getElementById('logoutButton');
    logoutButton.addEventListener('click', async () => {
        try {
            await signOut(auth);
            window.location.href = "frontend.html";
        } catch (error) {
            alert('Failed to log out. Please try again.');
        }
    });
    </script>
</body>
</html>
